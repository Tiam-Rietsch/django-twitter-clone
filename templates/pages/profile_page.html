{% extends 'pages/base.html' %}
{% load i18n %}
{% load account socialaccount %}
{% load user_extras %}
{% block content %}

<div class="logout-form-filter none">
    {% include 'account/logout_form.html' %}
</div>

<div class="menu-bar profile-menu">
    <a class="back-arrow" href="{{ request.META.HTTP_REFERER }}"><i class="fa fa-arrow-left" aria-hidden="true"></i></a>
    <h2>{{ profile.user.first_name }} {{ profile.user.last_name }}</h2>
</div>


<div class="container">

    <div class="navbar">
        {% include 'pages/navbar.html' %}
    </div>
    <div class="main-content profile-content">


        <div class="profile-content-wrapper">
            <div class="profile-image-wrapper">
                <div class="background-img"></div>
                <div class="profile-container detail-profile-container">
                    <img src="{{ profile.user|get_profile_picture }}" alt="">

                </div>
            </div>
            <div class="profile-detail-wrapper">
                <div class="profile-name-detail">
                    {% if profile.user != request.user %}
                    <button class="follow-button" onclick="followingAction()">
                        {% if request.user.profile in followers %}
                        <span>Un follow -</span>
                        {% else %}
                        <span>Follow +</span>
                        {% endif %}
                    </button>
                    {% endif %}
                    <h2>{{ profile.user.first_name }} {{ profile.user.last_name }}</h2>
                    <h3>@{{ profile.user.username }}</h3>
                </div>
                <div class="profile-date-detail">
                    <h4>Date joined {{ profile.date_joined }}</h4>
                </div>
                <div class="profile-following-details">
                    <h4>followers . {{ followers.count }}</h4>
                    <h4>following . {{ following.count }}</h4>
                </div>
            </div>
        </div>

        <div class="profile-tabs">
            <div class="tab-buttons-container">
                <button class="tab-btn active-tab-btn" onclick="showContent(event, 'Tweets')">Tweets</button>
                <button class="tab-btn" onclick="showContent(event, 'Replies')">Replies</button>
                <button class="tab-btn" onclick="showContent(event, 'Liked')">Liked</button>
            </div>
            <div class="tab-content">
                {% include 'tweet/tweet_list.html' with tweet_list=profile_tweets %}
            </div>
        </div>

    </div>
    <div class="suggestions">
        {% include 'tweet/popular_topics_list.html' %}
    </div>
</div>

{% endblock content %}


{% block script %}
<script>

    function showContent(event, content_type) {
        document.querySelectorAll('.tab-btn').forEach( item => {
            item.classList.remove('active-tab-btn')
        })
        event.currentTarget.classList.add('active-tab-btn')
        let contentContainer = document.querySelector('.tab-content')
        if (content_type == 'Tweets') {
            contentContainer.innerHTML = `{% include 'tweet/tweet_list.html' with tweet_list=profile_tweets %}`
        }
        else if (content_type == 'Replies') {
            contentContainer.innerHTML = `{% include 'tweet/tweet_list.html' with tweet_list=replied_tweets show_replies=True specific_user=profile.user %}`
        }
        else {
            contentContainer.innerHTML = `{% include 'tweet/tweet_list.html' with tweet_list=liked_tweets %}`
        }
    }

        //handle the liking of posts
        async function likeTweet(event) {
            console.log('liked')
            let item = event.currentTarget
            fetch("/", {
                method: 'GET',
                headers: {
                    'X-Requested-With': 'LikeButton',
                    'Content-Type': 'application/json',
                    'id': parseInt(item.value)
                }
            })
        }



    async function followingAction() {
        response = await fetch("{% url 'follow-user' profile.user.id %}", {
            method: 'GET',
            headers: {
                'X-Requested-With': 'followButton',
                'Content-Type': 'application/json'
            }
        })

        let data = await response.json()
        if (await data['followed']) {
            document.querySelector('.follow-button').innerHTML = `<span>Un Follow</span>`

        } else {
            document.querySelector('.follow-button').innerHTML = `<span>Follow</span>`
        }
    }
</script>
{% endblock script %}

